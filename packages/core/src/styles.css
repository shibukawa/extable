.extable-root {
	--extable-border: 1px solid #dadce0;
	--extable-accent: #3b82f6;
	--extable-invalid: #ef4444;
	--extable-header-bg: #e5e7eb;

	.extable-cell {
		border: var(--extable-border);
		padding: 4px 8px;
		position: relative;

		&.invalid {
			outline: 1px solid var(--extable-invalid);
		}
	}

	.extable-diag-warning::before,
	.extable-diag-error::before {
		content: "";
		position: absolute;
		top: 0;
		right: 0;
		width: 10px;
		height: 10px;
		background: linear-gradient(225deg, #f59e0b 50%, transparent 50%);
	}

	.extable-diag-error::before {
		background: linear-gradient(225deg, #ef4444 50%, transparent 50%);
	}

		/* Tooltip is defined at top-level to apply even when appended to <body>. */

	.pending {
		color: #b91c1c;
	}

	table[data-extable-renderer="html"],
	table[data-extable-renderer="canvas-html-overlay"] {
		border-collapse: collapse;
		width: 100%;
		background: transparent;
		table-layout: fixed;
	}

	table[data-extable-renderer="canvas-html-overlay"] {
		opacity: 0;
	}

	.extable-row-header {
		position: sticky;
		left: 0;
		background: #e5e7eb;
		text-align: center;
		padding: 4px 6px;
		border: var(--extable-border);
		font-weight: 600;
		color: #334155;
		z-index: 4;
	}

	.extable-corner {
		position: sticky;
		top: 0;
		left: 0;
		z-index: 6;
		background: #e5e7eb;
		padding: 0;
	}

	.extable-corner::after {
		content: "";
		position: absolute;
		top: 4px;
		left: 4px;
		width: 12px;
		height: 12px;
		background: linear-gradient(135deg, #9ca3af 50%, transparent 50%);
	}

  .extable-active-row-header,
  .extable-active-col-header {
    background: rgba(59, 130, 246, 0.16);
  }

	.extable-selected {
		background: rgba(59, 130, 246, 0.12) !important;
	}

	/* Selected but non-active cells keep spreadsheet-like cursor (cell). */
	td.extable-selected {
		cursor: cell;
	}

	/* Active editable cell shows text cursor, even when selected. */
	td.extable-active-cell.extable-editable {
		cursor: text;
	}

	/* Active readonly/boolean cells should not look editable. */
	td.extable-active-cell.extable-readonly {
		cursor: default;
	}

  .extable-all-selected td,
  .extable-all-selected th {
    background: rgba(59, 130, 246, 0.08) !important;
  }

	.extable-active-cell {
		outline: 2px solid var(--extable-accent);
		outline-offset: -2px;
		position: relative;

		&::after {
			content: "";
			position: absolute;
			width: 12px;
			height: 12px;
			right: 1px;
			bottom: 1px;
			background: var(--extable-accent);
			border: 1px solid #ffffff;
			cursor: crosshair;
			opacity: 0;
		}
	}

	&[data-extable-fill-handle="1"] {
		.extable-active-cell::after {
			opacity: 1;
		}
	}

		.extable-readonly {
			background: #f3f4f6 !important;
			color: #94a3b8 !important;
		}

		/* Selection highlight must remain visible even on readonly cells. */
		td.extable-selected.extable-readonly {
			background: rgba(59, 130, 246, 0.12) !important;
		}

		.extable-all-selected td.extable-readonly,
		.extable-all-selected th.extable-readonly {
			background: rgba(59, 130, 246, 0.08) !important;
		}

		/* Active boolean cell should not look text-editable. */
		td.extable-active-cell.extable-boolean {
			cursor: default;
		}

	th {
		position: relative;
		background: #e5e7eb;
		border: 1px solid #d0d7de;
		padding: 6px 8px;
		font-weight: 600;
		text-align: left;

		&::after {
			content: "";
			position: absolute;
			top: 0;
			right: -3px;
			width: 6px;
			height: 100%;
			cursor: col-resize;
		}
	}

	.extable-col-header {
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 8px;
		min-width: 0;
	}

	.extable-col-header-text {
		min-width: 0;
		overflow: hidden;
		text-overflow: ellipsis;
		white-space: nowrap;
	}

	.extable-filter-sort-trigger {
		flex: 0 0 auto;
		width: 22px;
		height: 22px;
		padding: 0;
		border: 1px solid rgba(148, 163, 184, 0.55);
		border-radius: 6px;
		background: rgba(255, 255, 255, 0.7);
		color: rgba(15, 23, 42, 0.85);
		cursor: pointer;
		opacity: 0;
		display: inline-flex;
		align-items: center;
		justify-content: center;
		line-height: 1;
		color: rgba(15, 23, 42, 0.75);

		&:hover,
		&:focus-visible {
			opacity: 1;
			outline: none;
			background: rgba(255, 255, 255, 0.92);
			border-color: rgba(59, 130, 246, 0.7);
			color: rgba(15, 23, 42, 0.92);
		}
	}

	th:hover .extable-filter-sort-trigger {
		opacity: 0.55;
	}

	th[data-extable-fs-active="1"] .extable-filter-sort-trigger,
	th[data-extable-sort-dir] .extable-filter-sort-trigger {
		opacity: 0.75;
	}

	th:hover[data-extable-fs-active="1"] .extable-filter-sort-trigger,
	th:hover[data-extable-sort-dir] .extable-filter-sort-trigger {
		opacity: 1;
	}

		td {
			border: 1px solid #d0d7de;
			padding: 4px 6px;
			min-width: 80px;
			cursor: cell;

			&:focus-within {
				outline: 2px solid #2b7fff;
				outline-offset: -1px;
			}

		&.pending {
			color: #b91c1c;
		}
	}

	.extable-context-menu hr.extable-context-sep {
		border: 0;
		border-top: 1px solid #e5e7eb;
		margin: 6px 0;
	}

	thead th {
		position: sticky;
		top: 0;
		z-index: 5;
	}

	input {
		border: none;
		padding: 2px 4px;
		width: 100%;
		box-sizing: border-box;
		background: #fff;
		font: inherit;

		&:focus {
			outline: none;
		}
	}

	.cell-nowrap {
		white-space: nowrap;
		text-overflow: ellipsis;
		overflow: hidden;
	}

	.cell-wrap {
		white-space: pre-wrap;
		text-overflow: clip;
		overflow-wrap: anywhere;
	}

	.align-left {
		text-align: left;
	}

	.align-right {
		text-align: right;
	}
}

.extable-context-menu {
	border: none;
	padding: 6px 0;
	border-radius: 8px;
	background: rgba(255, 255, 255, 0.98);
	box-shadow: 0 18px 38px rgba(0, 0, 0, 0.25), 0 8px 12px rgba(0, 0, 0, 0.18);
	backdrop-filter: blur(6px);
	min-width: 200px;
	position: fixed;
	margin: 0;
	inset: auto;
	z-index: 1000;
	pointer-events: auto;

	&::backdrop {
		background: transparent;
	}

	button {
		display: flex;
		gap: 8px;
		align-items: center;
		width: 100%;
		padding: 8px 14px;
		background: transparent;
		border: none;
		font: inherit;
		text-align: left;
		cursor: pointer;

		&:hover,
		&:focus-visible {
			background: rgba(59, 130, 246, 0.12);
			outline: none;
		}
	}
}

.extable-shell {
	display: flex;
	width: 100%;
	height: 100%;
	min-width: 0;
	min-height: 0;
}

.extable-viewport {
	flex: 1;
	min-width: 0;
	min-height: 0;
	overflow: auto;
	overscroll-behavior: contain;
}

.extable-overlay-layer {
	position: sticky;
	top: 0;
	left: 0;
	width: 0;
	height: 0;
	pointer-events: none;
	z-index: 20;
}

.extable-search-sidebar {
	flex: 0 0 0px;
	width: 0px;
	min-width: 0;
	border-left: 0px solid #e5e7eb;
	background: rgba(255, 255, 255, 0.98);
	backdrop-filter: blur(6px);
	display: flex;
	flex-direction: column;
	gap: 10px;
	padding: 0px;
	transform: translateX(12px);
	opacity: 0;
	pointer-events: none;
	transition:
		flex-basis 180ms ease-out,
		width 180ms ease-out,
		padding 180ms ease-out,
		border-left-width 180ms ease-out,
		opacity 180ms ease-out,
		transform 180ms ease-out;
}

.extable-search-open .extable-search-sidebar {
	flex-basis: 340px;
	width: 340px;
	padding: 12px;
	border-left-width: 1px;
	opacity: 1;
	transform: translateX(0);
	pointer-events: auto;
}

.extable-filter-sort-sidebar {
	flex: 0 0 0px;
	width: 0px;
	min-width: 0;
	border-left: 0px solid #e5e7eb;
	background: rgba(255, 255, 255, 0.98);
	backdrop-filter: blur(6px);
	display: flex;
	flex-direction: column;
	gap: 10px;
	padding: 0px;
	transform: translateX(12px);
	opacity: 0;
	pointer-events: none;
	transition:
		flex-basis 180ms ease-out,
		width 180ms ease-out,
		padding 180ms ease-out,
		border-left-width 180ms ease-out,
		opacity 180ms ease-out,
		transform 180ms ease-out;
}

.extable-filter-sort-open .extable-filter-sort-sidebar {
	flex-basis: 360px;
	width: 360px;
	padding: 12px;
	border-left-width: 1px;
	opacity: 1;
	transform: translateX(0);
	pointer-events: auto;
}

.extable-filter-sort-header {
	display: flex;
	flex-direction: column;
	gap: 8px;
}

.extable-filter-sort-row {
	display: flex;
	align-items: center;
	gap: 10px;
	justify-content: space-between;
}

.extable-filter-sort-title {
	font-weight: 700;
	color: #0f172a;
}

.extable-filter-sort-close {
	width: 28px;
	height: 28px;
	border-radius: 8px;
	border: 1px solid rgba(148, 163, 184, 0.5);
	background: rgba(255, 255, 255, 0.8);
	cursor: pointer;
}

.extable-filter-sort-body {
	display: flex;
	flex-direction: column;
	gap: 12px;
	min-height: 0;
	flex: 1;
	overflow: hidden;
}

.extable-filter-sort-section {
	display: flex;
	flex-direction: column;
	gap: 8px;
	border: 1px solid rgba(148, 163, 184, 0.35);
	border-radius: 12px;
	padding: 10px;
	background: rgba(248, 250, 252, 0.7);
}

.extable-filter-sort-section-filter {
	flex: 1;
	min-height: 0;
}

.extable-filter-sort-section-sort {
	flex: 0 0 auto;
}

.extable-filter-sort-section-title {
	font-weight: 700;
	color: #0f172a;
}

.extable-filter-sort-values {
	min-height: 0;
	flex: 1;
	overflow: auto;
	border: 1px solid rgba(148, 163, 184, 0.35);
	border-radius: 10px;
	padding: 8px;
	background: rgba(255, 255, 255, 0.9);
}

.extable-filter-sort-values label {
	display: flex;
	gap: 8px;
	align-items: center;
	padding: 4px 2px;
}

.extable-filter-sort-actions {
	display: flex;
	gap: 8px;
	flex-wrap: wrap;
}

.extable-filter-sort-actions button {
	padding: 6px 10px;
	border-radius: 10px;
	border: 1px solid rgba(148, 163, 184, 0.55);
	background: rgba(255, 255, 255, 0.9);
	cursor: pointer;
}

.extable-filter-sort-actions button:hover,
.extable-filter-sort-actions button:focus-visible {
	outline: none;
	border-color: rgba(59, 130, 246, 0.7);
}

.extable-tooltip {
	position: absolute;
	pointer-events: none;
	z-index: 9999;
	display: none;
	max-width: 360px;
	padding: 8px 10px;
	border-radius: 10px;
	background: #111827;
	color: #f8fafc;
	font-size: 12px;
	line-height: 1.25;
	box-shadow: 0 12px 28px rgba(0, 0, 0, 0.28);
	border: 1px solid rgba(148, 163, 184, 0.35);
	white-space: pre-wrap;
}

.extable-tooltip[data-visible="1"] {
	display: block;
}

.extable-tooltip::after {
	content: "";
	position: absolute;
	top: 10px;
	width: 0;
	height: 0;
	border: 7px solid transparent;
}

.extable-tooltip[data-side="right"]::after {
	left: -14px;
	border-right-color: #111827;
}

.extable-tooltip[data-side="left"]::after {
	right: -14px;
	border-left-color: #111827;
}

/* HTML-only: show tooltip on cell hover (anchored to the cell, no JS). */
.extable-root td[data-extable-diag-message]:hover::after {
	content: attr(data-extable-diag-message);
	position: absolute;
	top: 6px;
	left: calc(100% + 10px);
	max-width: 360px;
	padding: 8px 10px;
	border-radius: 10px;
	background: #111827;
	color: #f8fafc;
	font-size: 12px;
	line-height: 1.25;
	box-shadow: 0 12px 28px rgba(0, 0, 0, 0.28);
	border: 1px solid rgba(148, 163, 184, 0.35);
	white-space: pre-wrap;
	z-index: 20;
}

.extable-root td[data-extable-diag-message]:hover::before {
	content: "";
	position: absolute;
	top: 14px;
	left: calc(100% + 2px);
	width: 0;
	height: 0;
	border: 7px solid transparent;
	border-right-color: #111827;
	z-index: 21;
}

.extable-search-header {
	display: flex;
	flex-direction: column;
	gap: 8px;
}

.extable-search-row {
	display: flex;
	gap: 10px;
	align-items: center;
}

.extable-search-label {
	flex: 1;
	display: flex;
	gap: 8px;
	align-items: center;
}

.extable-search-close {
	border: none;
	background: transparent;
	font-size: 18px;
	line-height: 1;
	padding: 6px 8px;
	cursor: pointer;
}

.extable-search-status {
	justify-content: space-between;
	font-size: 12px;
	color: #475569;
}

.extable-search-error {
	color: #b91c1c;
}

.extable-search-body {
	display: flex;
	flex-direction: column;
	gap: 10px;
	min-height: 0;
}

.extable-search-actions {
	display: flex;
	gap: 8px;
	flex-wrap: wrap;
}

.extable-search-actions button {
	padding: 6px 10px;
	border-radius: 8px;
	border: 1px solid #d0d7de;
	background: #ffffff;
	cursor: pointer;
}

.extable-search-actions button:disabled {
	opacity: 0.5;
	cursor: default;
}

.extable-search-results {
	flex: 1;
	min-height: 0;
	overflow: auto;
	border: 1px solid #e5e7eb;
	border-radius: 10px;
	background: #fff;
}

.extable-search-table {
	width: 100%;
	border-collapse: collapse;
	font-size: 12px;
	table-layout: fixed;
}

.extable-search-table th,
.extable-search-table td {
	border-bottom: 1px solid #eef2f7;
	padding: 6px 8px;
	vertical-align: top;
}

.extable-search-table th {
	position: sticky;
	top: 0;
	background: #ffffff;
	z-index: 1;
	text-align: left;
	color: #334155;
}

.extable-search-table th:first-child,
.extable-search-table td:first-child {
	width: 72px;
	white-space: nowrap;
}

.extable-search-table th:nth-child(2),
.extable-search-table td:nth-child(2) {
	width: auto;
}

.extable-search-table td:nth-child(2) {
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
}

.extable-search-result-row {
	cursor: pointer;
}

.extable-search-result-row:hover,
.extable-search-result-row:focus-visible {
	outline: none;
	background: rgba(59, 130, 246, 0.08);
}

.extable-search-result-row[data-active="1"] {
	background: rgba(59, 130, 246, 0.12);
}

.extable-toast {
	border-radius: 8px;
	padding: 10px 14px;
	background: rgba(25, 25, 28, 0.92);
	color: #f8fafc;
	box-shadow: 0 12px 30px rgba(0, 0, 0, 0.28), 0 6px 12px rgba(0, 0, 0, 0.18);
	font-size: 13px;
	max-width: 320px;
	line-height: 1.4;
}

.extable-toast[data-variant="error"] {
	background: rgba(220, 38, 38, 0.92);
}
