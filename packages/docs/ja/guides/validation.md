# ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰

Extableã¯ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã‚’ä¿ã¤ãŸã‚ã«è¤‡æ•°ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å±¤ã‚’æä¾›ã—ã¾ã™ã€‚å‹åˆ¶ç´„ã€æ•°å¼ã«ã‚ˆã‚‹æ¤œè¨¼ã€ä¸€æ„åˆ¶ç´„ã¾ã§ã€å®Ÿè£…æ–¹æ³•ã‚’ã¾ã¨ã‚ã¾ã™ã€‚

## ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å±¤

Extableã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¯3å±¤ã§æ§‹æˆã•ã‚Œã¾ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å‹/ã‚¹ã‚­ãƒ¼ãƒåˆ¶ç´„ï¼ˆæœ€é€Ÿï¼‰             â”‚
â”‚    - å‹æ¤œè¨¼                             â”‚
â”‚    - æ–‡å­—æ•°/ç¯„å›²åˆ¶é™                    â”‚
â”‚    - ãƒ‘ã‚¿ãƒ¼ãƒ³ä¸€è‡´                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ•°å¼ã«ã‚ˆã‚‹ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³    â”‚
â”‚    - è¤‡é›‘ãªæ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯                â”‚
â”‚    - æ–‡è„ˆä»˜ãã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸          â”‚
â”‚    - å¤‰æ›´æ™‚ã«å†è©•ä¾¡                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ä¸€æ„åˆ¶ç´„                              â”‚
â”‚    - åˆ—å˜ä½ã®ä¸€æ„æ€§                      â”‚
â”‚    - è¤‡æ•°åˆ—ã®çµ„ã¿åˆã‚ã›                  â”‚
â”‚    - è¡Œã‚’è·¨ãä¾å­˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ãƒ¬ã‚¤ãƒ¤ãƒ¼1: å‹/ã‚¹ã‚­ãƒ¼ãƒåˆ¶ç´„

### å‹ãƒ™ãƒ¼ã‚¹ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

åˆ—ã®å‹ã«å¯¾ã—ã¦è‡ªå‹•çš„ã«æ¤œè¨¼ã•ã‚Œã¾ã™ã€‚

```typescript
{
  key: 'email',
  header: 'Email',
  type: 'string',
  string: {
    regex: '^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$'
  }
}

{
  key: 'age',
  header: 'Age',
  type: 'number',
  format: {
    signed: false  // éè² ã®ã¿
  }
}

{
  key: 'birthDate',
  header: 'Birth Date',
  type: 'date'
  // ISOæ—¥ä»˜ã§ã‚ã‚‹å¿…è¦ã‚ã‚Š
}
```

**è‡ªå‹•æ¤œè¨¼ã•ã‚Œã‚‹é …ç›®:**
- âœ… å‹ãŒä¸€è‡´ã™ã‚‹
- âœ… æ–‡å­—åˆ—é•·ãŒ`string.maxLength`ä»¥å†…
- âœ… `string.regex`ã«ä¸€è‡´
- âœ… `number.signed: false`ãªã‚‰éè² 
- âœ… æ—¥ä»˜å½¢å¼ãŒæ­£ã—ã„
- âœ… `enum.options`ã«ä¸€è‡´
- âœ… `tags.options`ã«ä¸€è‡´ï¼ˆ`allowCustom`ãŒfalseã®å ´åˆï¼‰
- âœ… booleanå‹ã®æ­£å½“æ€§

### é•·ã•/ç¯„å›²åˆ¶ç´„

```typescript
// æ–‡å­—åˆ—é•·ã®æ¤œè¨¼
{
  key: 'username',
  type: 'string',
  string: {
    maxLength: 20
    // âœ“ "alice", "bob123" ï¼ˆæœ‰åŠ¹ï¼‰
    // âœ— "thisisaverylongusernamethatwontfit" ï¼ˆé•·ã™ãã‚‹ï¼‰
  }
}

// æ•°å€¤ç¯„å›²ã®æ¤œè¨¼ï¼ˆéè² ã®ã¿ï¼‰
{
  key: 'rating',
  type: 'number',
  format: {
    signed: false  // 0ä»¥ä¸Š
    // âœ“ 0, 1, 2, 3, 4, 5 ï¼ˆæœ‰åŠ¹ï¼‰
    // âœ— -1 ï¼ˆè² æ•°ä¸å¯ï¼‰
  }
}

// æ—¥ä»˜ç¯„å›²ã®æ¤œè¨¼
{
  key: 'birthDate',
  type: 'date',
  nullable: false
  // âœ“ "1990-01-15" ï¼ˆæœ‰åŠ¹ãªæ—¥ä»˜ï¼‰
  // âœ— "not-a-date", null ï¼ˆç„¡åŠ¹ï¼‰
}

// æ–‡å­—åˆ—ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œè¨¼ï¼ˆæ­£è¦è¡¨ç¾ï¼‰
{
  key: 'phone',
  type: 'string',
  string: {
    regex: '^\\d{3}-\\d{4}-\\d{4}$'
    // âœ“ "123-4567-8901" ï¼ˆæœ‰åŠ¹ï¼‰
    // âœ— "1234567890" ï¼ˆãƒ‘ã‚¿ãƒ¼ãƒ³ä¸ä¸€è‡´ï¼‰
  }
}
```

min/maxã®ç¯„å›²æ¤œè¨¼ã¯ã‚«ã‚¹ã‚¿ãƒ æ•°å¼ï¼ˆãƒ¬ã‚¤ãƒ¤ãƒ¼2ï¼‰ã§è¡Œã„ã¾ã™ã€‚

### Nullableã¨å¿…é ˆ

```typescript
// å¿…é ˆé …ç›®ï¼ˆå€¤ãŒå¿…è¦ï¼‰
{
  key: 'name',
  type: 'string',
  nullable: false
  // âœ“ "Alice", ""ï¼ˆç©ºã‚’è¨±å¯ã™ã‚‹å ´åˆï¼‰
  // âœ— null, undefined
}

// ä»»æ„é …ç›®ï¼ˆç©º/Nullå¯ï¼‰
{
  key: 'middleName',
  type: 'string',
  nullable: true
  // âœ“ "James", null, ""ï¼ˆã™ã¹ã¦æœ‰åŠ¹ï¼‰
  // âœ— ï¼ˆç„¡åŠ¹ãªã—ï¼‰
}

// èª­ã¿å–ã‚Šå°‚ç”¨ã®è¨ˆç®—åˆ—ï¼ˆç·¨é›†ä¸å¯ï¼‰
{
  key: 'totalPrice',
  type: 'number',
  readonly: true,
  formula: (row) => row.quantity * row.unitPrice
}
```

### ã‚¹ã‚­ãƒ¼ãƒãƒ¬ãƒ™ãƒ«ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

Extableã¯ä»¥ä¸‹ã§ã‚¨ãƒ©ãƒ¼ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
- ğŸ”´ ç„¡åŠ¹ã‚»ãƒ«ã®èµ¤æ 
- âš ï¸ ãƒ†ãƒ¼ãƒ–ãƒ«çŠ¶æ…‹ã®ã‚¨ãƒ©ãƒ¼æ•°
- ğŸ“‹ `getTableState().activeErrors`ã«è©³ç´°

```typescript
// æ¤œè¨¼ã‚¨ãƒ©ãƒ¼ã‚’ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§å–å¾—
const state = table.getTableState();
console.log(state.activeErrors);
// [
//   { scope: 'validation', message: 'ãƒ¡ãƒ¼ãƒ«ã¯æœ‰åŠ¹ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™', target: { rowId: 'row1', colKey: 'email' } },
//   { scope: 'validation', message: 'å¹´é½¢ã¯0ã€œ150ã®ç¯„å›²', target: { rowId: 'row2', colKey: 'age' } }
// ]
```

## ãƒ¬ã‚¤ãƒ¤ãƒ¼2: æ•°å¼ã«ã‚ˆã‚‹ã‚«ã‚¹ã‚¿ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

### æ•°å¼ã‹ã‚‰ã®ã‚¨ãƒ©ãƒ¼è¿”å´

å‹åˆ¶ç´„ã‚’è¶…ãˆã‚‹æ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯ã¯æ•°å¼ã§æ¤œè¨¼ã—ã¾ã™ã€‚

```typescript
{
  key: 'password',
  header: 'Password',
  type: 'string',
  // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼ç”¨ã®éš ã—è¨ˆç®—åˆ—
  string: { allowMultiline: false },
  formula: (row) => {
    const pwd = row.password;
    
    // è¤‡æ•°ã®æ¤œè¨¼ãƒ«ãƒ¼ãƒ«
    if (!pwd || pwd.length < 8) {
      return [pwd, new Error('Password must be at least 8 characters')];
    }
    if (!/[A-Z]/.test(pwd)) {
      return [pwd, new Error('Must contain at least one uppercase letter')];
    }
    if (!/[0-9]/.test(pwd)) {
      return [pwd, new Error('Must contain at least one number')];
    }
    
    // æœ‰åŠ¹ãªã‚‰è¡¨ç¤ºç”¨ã®å€¤ã‚’è¿”ã™
    return 'â—'.repeat(pwd.length);  // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šãƒ‰ãƒƒãƒˆã§è¡¨ç¤º
  }
}
```

**æ•°å¼ã®ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³:**

```typescript
formula: (row) => {
  // æ¤œè¨¼ãƒã‚§ãƒƒã‚¯
  if (isInvalid(row)) {
    // [è¡¨ç¤ºå€¤, ã‚¨ãƒ©ãƒ¼]ã‚’è¿”ã™
    return [row.value, new Error('Human-readable error message')];
  }
  
  // æ­£å¸¸æ™‚ã¯è¨ˆç®—å€¤ã‚’è¿”ã™
  return computedValue;
}
```

### æ–‡è„ˆä»˜ãã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

ä»–ã®ã‚»ãƒ«ã‚’å‚ç…§ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åŸå› ã‚’ä¼ãˆã¾ã™ã€‚

```typescript
{
  key: 'endDate',
  header: 'End Date',
  type: 'date',
  formula: (row) => {
    const startDate = new Date(row.startDate);
    const endDate = new Date(row.endDate);
    
    if (endDate <= startDate) {
      return [
        row.endDate,
        new Error(
          `End date (${row.endDate}) must be after start date (${row.startDate})`
        ï¼‰
      ];
    }
    
    // è¡¨ç¤ºç”¨ã«æœŸé–“ã‚’è¨ˆç®—
    const days = Math.floor((endDate - startDate) / (1000 * 60 * 60 * 24));
    return `${days} days`;
  }
}
```

### æ¡ä»¶ä»˜ãã‚¹ã‚¿ã‚¤ãƒ«ã¨çµ„ã¿åˆã‚ã›

```typescript
{
  key: 'discount',
  header: 'Discount %',
  type: 'number',
  format: { min: 0, max: 100 },
  
  // æ¤œè¨¼ã¨è­¦å‘Šè¡¨ç¤ºã‚’è¡Œã†è¨ˆç®—åˆ—
  formula: (row) => {
    if (row.discount > 50) {
      return [
        row.discount,
        new Error('Discount exceeds 50% - requires manager approval'ï¼‰
      ];
    }
    if (row.discount > 25) {
      return [
        row.discount,
        new Error('Discount exceeds 25% - review required'ï¼‰
      ];
    }
    return row.discount;
  },
  
  // å‰²å¼•ãƒ¬ãƒ™ãƒ«ã‚’è‰²ã§å¯è¦–åŒ–
  conditionalStyle: (row) => {
    if (row.discount > 50) {
      return { backgroundColor: '#ffcdd2', textColor: '#c62828' };  // èµ¤
    }
    if (row.discount > 25) {
      return { backgroundColor: '#fff3e0', textColor: '#e65100' };  // ã‚ªãƒ¬ãƒ³ã‚¸
    }
    if (row.discount > 10) {
      return { backgroundColor: '#e8f5e9', textColor: '#2e7d32' };  // ç·‘
    }
    return null;
  }
}
```

### è¡Œã‚’è·¨ãæ¤œè¨¼

```typescript
{
  key: 'email',
  header: 'Email Address',
  type: 'string',
  string: { pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/ },
  
  formula: (row, allRows) => {
    const email = row.email;
    
    // ãƒ†ãƒ¼ãƒ–ãƒ«å†…ã§ãƒ¡ãƒ¼ãƒ«ã®ä¸€æ„æ€§ã‚’ç¢ºèª
    const duplicates = allRows.filter(
      r => r.email === email && r.id !== row.id
    );
    
    if (duplicates.length > 0) {
      return [
        email,
        new Error(`Email "${email}" is already used by another user`ï¼‰
      ];
    }
    
    return email;
  }
}
```

**Note:** ã‚µãƒ¼ãƒãƒ¼å´ã®ä¸€æ„æ€§ãƒã‚§ãƒƒã‚¯ã¯ãƒ¬ã‚¤ãƒ¤ãƒ¼3ã®ä¸€æ„åˆ¶ç´„ã§æ‰±ã†ã®ãŒé©åˆ‡ã§ã™ã€‚

## ãƒ¬ã‚¤ãƒ¤ãƒ¼3: ä¸€æ„åˆ¶ç´„

### åˆ—å˜ä½ã®ä¸€æ„æ€§

```typescript
{
  key: 'username',
  header: 'Username',
  type: 'string',
  unique: true  // ãƒ†ãƒ¼ãƒ–ãƒ«å†…ã§ä¸€æ„
  // âœ“ alice, bob, charlie ï¼ˆã™ã¹ã¦ç•°ãªã‚‹ï¼‰
  // âœ— alice, bob, alice ï¼ˆé‡è¤‡ä¸å¯ï¼‰
}

{
  key: 'email',
  header: 'Email',
  type: 'string',
  unique: true
}
```

**æŒ™å‹•:**
- æ¤œè¨¼ã‚¿ã‚¤ãƒŸãƒ³ã‚°: ç·¨é›†ã€è¡Œè¿½åŠ ã€ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
- è¡¨ç¤º: èµ¤æ  + `getTableState().activeErrors`ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- ã‚µãƒ¼ãƒãƒ¼åŒæœŸ: é€šå¸¸ã¯ã‚µãƒ¼ãƒãƒ¼å´ã§ã‚‚æ¤œè¨¼ã™ã‚‹

### è¤‡æ•°åˆ—ã®ä¸€æ„åˆ¶ç´„

```typescript
// ã‚¹ã‚­ãƒ¼ãƒãƒ¬ãƒ™ãƒ«ã®ä¸€æ„åˆ¶ç´„
const schema = {
  columns: [
    { key: 'company', type: 'string' },
    { key: 'department', type: 'string' },
    { key: 'employeeId', type: 'string' }
  ],
  
  // çµ„ã¿åˆã‚ã›ã®ä¸€æ„åˆ¶ç´„
  unique: [
    ['company', 'department', 'employeeId']  // ã“ã®çµ„ã¿åˆã‚ã›ã¯ä¸€æ„
  ]
  // âœ“ (Apple, Engineering, E001), (Apple, HR, E001), (Google, Engineering, E001)ï¼ˆé‡è¤‡ãªã—ï¼‰
  // âœ— (Apple, Engineering, E001), (Apple, Engineering, E001)ï¼ˆé‡è¤‡ï¼‰
}
```

**ç”¨é€”:**
- éƒ¨ç½²ã”ã¨ã®ç¤¾å“¡IDã®é‡è¤‡é˜²æ­¢
- ä¼šç¤¾ã”ã¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ãƒ¼ãƒ‰
- å§“åã®çµ„ã¿åˆã‚ã›ä¸€æ„æ€§

### æ¡ä»¶ä»˜ãä¸€æ„åˆ¶ç´„

```typescript
{
  key: 'email',
  header: 'Email',
  type: 'string',
  
  formula: (row, allRows) => {
    // activeãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿ä¸€æ„æ€§ã‚’é©ç”¨
    if (row.status !== 'active') {
      return row.email;
    }
    
    // activeãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ã§ã®ã¿ä¸€æ„æ€§ç¢ºèª
    const activeEmails = allRows
      .filter(r => r.status === 'active'ï¼‰
      .map(r => r.email);
    
    const isDuplicate = activeEmails.filter(e => e === row.email).length > 1;
    
    if (isDuplicate) {
      return [
        row.email,
        new Error(`Email "${row.email}" is already used by another active user`ï¼‰
      ];
    }
    
    return row.email;
  }
}
```

## ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã¨å‡¦ç†

### ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘è¡¨ç¤º

```typescript
// 1. èµ¤ã„æ ï¼ç„¡åŠ¹ã‚»ãƒ«
// 2. ã‚»ãƒ«ã«ã‚¨ãƒ©ãƒ¼ã‚¢ã‚¤ã‚³ãƒ³
// 3. ã‚»ãƒ«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«è©³ç´°

// ã‚¨ãƒ©ãƒ¼ã‚’ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã§å–å¾—
table.subscribeTableState((state) => {
  const errors = state.activeErrors;
  
  errors.forEach(error => {
    console.log(`Row ${error.target.rowId}, Col ${error.target.colKey}: ${error.message}`);
  });
});

// é¸æŠè¿½è·¡ã§ã‚‚å–å¾—
table.subscribeSelection((snapshot) => {
  if (snapshot.diagnostic) {
    console.log('Active cell has error:', snapshot.diagnostic.message);
  }
});
```

### ã‚¨ãƒ©ãƒ¼ã®ã‚¹ã‚³ãƒ¼ãƒ—

```typescript
// ã‚¹ã‚­ãƒ¼ãƒæ¤œè¨¼ã‚¨ãƒ©ãƒ¼
{
  scope: 'validation',
  message: 'ãƒ¡ãƒ¼ãƒ«ã¯æœ‰åŠ¹ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™',
  target: { rowId: 'row1', colKey: 'email' }
}

// æ•°å¼ã‚¨ãƒ©ãƒ¼ï¼ˆã‚«ã‚¹ã‚¿ãƒ æ¤œè¨¼ï¼‰
{
  scope: 'formula',
  message: 'Password must be at least 8 characters',
  target: { rowId: 'row2', colKey: 'password' }
}

// ä¸€æ„æ€§ã‚¨ãƒ©ãƒ¼
{
  scope: 'unique',
  message: 'Email is not unique',
  target: { rowId: 'row3', colKey: 'email' }
}

// è¨ºæ–­ã‚¨ãƒ©ãƒ¼ï¼ˆæ•°å¼ä¾‹å¤–ï¼‰
{
  scope: 'diagnostic',
  message: 'Unexpected error in formula',
  target: { rowId: 'row4', colKey: 'computed' }
}
```

### ã‚¨ãƒ©ãƒ¼ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

```typescript
const state = table.getTableState();

// æ¤œè¨¼ã‚¨ãƒ©ãƒ¼ã®ã¿
const typeErrors = state.activeErrors.filter(e => e.scope === 'validation');

// æ•°å¼ã‚¨ãƒ©ãƒ¼ã®ã¿
const formulaErrors = state.activeErrors.filter(e => e.scope === 'formula');

// ç‰¹å®šè¡Œã®ã¿
const rowErrors = state.activeErrors.filter(e => e.target?.rowId === 'row1');

// ç‰¹å®šåˆ—ã®ã¿
const colErrors = state.activeErrors.filter(e => e.target?.colKey === 'email');

// ã‚¨ãƒ©ãƒ¼æ•°ã§
console.log(`Table has ${state.activeErrors.length} validation issues`);
```

## ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³

### ãƒ‘ã‚¿ãƒ¼ãƒ³1: ãƒ¡ãƒ¼ãƒ«æ¤œè¨¼

```typescript
{
  key: 'email',
  header: 'Email Address',
  type: 'string',
  string: {
    pattern: /^[^\s@]+@[^\s@]+\.[^\s@]+$/,
    length: { min: 5, max: 254 }
  },
  formula: (row, allRows) => {
    // activeãƒ¦ãƒ¼ã‚¶ãƒ¼é–“ã®ä¸€æ„æ€§ç¢ºèª
    if (row.status === 'active') {
      const duplicates = allRows.filter(
        r => r.status === 'active' && r.email === row.email && r.id !== row.id
      );
      if (duplicates.length > 0) {
        return [row.email, new Error('Email already in use')];
      }
    }
    return row.email;
  }
}
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³2: æ—¥ä»˜ç¯„å›²

```typescript
{
  key: 'projectEndDate',
  header: 'End Date',
  type: 'date',
  formula: (row) => {
    const start = new Date(row.projectStartDate);
    const end = new Date(row.projectEndDate);
    
    if (!row.projectStartDate || !row.projectEndDate) {
      return [row.projectEndDate, new Error('Both dates required')];
    }
    
    if (end <= start) {
      return [
        row.projectEndDate,
        new Error(`End date must be after start date (${row.projectStartDate})`ï¼‰
      ];
    }
    
    const days = Math.ceil((end - start) / (1000 * 60 * 60 * 24));
    return `${days} days`;
  }
}
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³3: ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸è­¦å‘Š

```typescript
{
  key: 'completionPercent',
  header: 'Complete %',
  type: 'number',
  format: { min: 0, max: 100, scale: 0 },
  
  formula: (row) => {
    const pct = row.completionPercent;
    
    if (pct < 0 || pct > 100) {
      return [pct, new Error('Must be between 0 and 100')];
    }
    
    if (pct === 100 && !row.completedDate) {
      return [pct, new Error('Completion date required when 100% complete')];
    }
    
    return `${pct}%`;
  },
  
  conditionalStyle: (row) => {
    const pct = row.completionPercent;
    if (pct === 100) return { backgroundColor: '#c8e6c9' };     // ç·‘
    if (pct >= 75) return { backgroundColor: '#fff9c4' };       // é»„
    if (pct >= 50) return { backgroundColor: '#ffe0b2' };       // ã‚ªãƒ¬ãƒ³ã‚¸
    return { backgroundColor: '#ffcdd2' };                      // èµ¤
  }
}
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³4: ä¾å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰

```typescript
{
  key: 'requiresApproval',
  header: 'Needs Approval?',
  type: 'boolean',
  
  formula: (row) => {
    // ä»–ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰è‡ªå‹•è¨ˆç®—
    const requiresApproval = 
      row.amount > 10000 ||
      row.category === 'sensitive' ||
      row.riskLevel === 'high';
    
    if (requiresApproval && !row.approverName) {
      return [
        requiresApproval,
        new Error('Approver must be assigned for high-risk transactions'ï¼‰
      ];
    }
    
    return requiresApproval;
  }
}
```

## ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### Do âœ…

- **å±¤ã‚’ä½¿ã„åˆ†ã‘ã‚‹**: å‹åˆ¶ç´„â†’æ•°å¼â†’ä¸€æ„åˆ¶ç´„
- **æ˜ç¢ºãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: ä½•ãŒã©ã†æ‚ªã„ã‹ã‚’ç¤ºã™
- **æ¡ä»¶ä»˜ãã‚¹ã‚¿ã‚¤ãƒ«**ã§è¦–è¦šçš„ã«å¼·èª¿
- **readonlyã¨ã®ä½µç”¨**: è¨ˆç®—åˆ—ã¯readonlyã«ã™ã‚‹
- **å¢ƒç•Œã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ**: ç©ºã€nullã€æ¥µç«¯å€¤

### Don't âŒ

- **æ•°å¼ã‚’è¤‡é›‘ã«ã—ã™ããªã„**
- **ã‚¨ãƒ©ãƒ¼ã‚’éš ã•ãªã„**
- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã ã‘ã«é ¼ã‚‰ãªã„**ï¼ˆã‚µãƒ¼ãƒãƒ¼å´ã¯å¿…é ˆï¼‰
- **å¾ªç’°å‚ç…§ã‚’é¿ã‘ã‚‹**
- **ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãªã—ã®æ¤œè¨¼ã‚’ã—ãªã„**

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è€ƒæ…®

### æ¤œè¨¼ã‚¿ã‚¤ãƒŸãƒ³ã‚°

```typescript
// å‹æ¤œè¨¼: å³æ™‚ï¼ˆæ•°å¼å‰ï¼‰
// æ•°å¼æ¤œè¨¼: ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã”ã¨ã«è¡Œå˜ä½
// ä¸€æ„æ€§æ¤œè¨¼: ã‚»ãƒ«å¤‰æ›´æ™‚ã«åˆ—å˜ä½

// æœ€é©åŒ–ã®æµã‚Œ:
- Type constraint fails â†’ cell marked red immediately
- Formula runs â†’ may add additional errors
- Unique check runs â†’ cross-row comparison
```

### æ•°å¼æ¤œè¨¼ã®æœ€é©åŒ–

```typescript
// âŒ NG: æ•°å¼å†…ã®é‡ã„è¨ˆç®—
formula: (row, allRows) => {
  const expensive = allRows.map(r => {
    // å„è¡Œã§é‡ã„è¨ˆç®—
    return processRow(r);
  });
  return expensive;
}

// âœ… OK: å¯¾è±¡è¡Œã®ã¿æ¤œè¨¼
formula: (row) => {
  // ã“ã®è¡Œã ã‘æ¤œè¨¼
  if (row.value < 0) {
    return [row.value, new Error('Must be positive')];
  }
  return row.value;
}
```

## é€ä¿¡å‰ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

```typescript
// commitå‰ã«ã‚¨ãƒ©ãƒ¼ç¢ºèª
table.subscribeTableState((state) => {
  const hasErrors = state.activeErrors.length > 0;
  
  if (hasErrors) {
    document.getElementById('commitBtn').disabled = true;
    document.getElementById('errorMsg').textContent = 
      `Fix ${state.activeErrors.length} validation error(s)`;
  } else {
    document.getElementById('commitBtn').disabled = false;
    document.getElementById('errorMsg').textContent = '';
  }
});

// æ­£å¸¸æ™‚ã®ã¿commit
async function saveData() {
  const state = table.getTableState();
  
  if (state.activeErrors.length > 0) {
    alert('Please fix validation errors before saving');
    return;
  }
  
  await table.commit();
}
```

## ã‚µãƒ¼ãƒãƒ¼å´ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã ã‘ã§ã¯ä¸ååˆ†ã§ã™ã€‚ã‚µãƒ¼ãƒãƒ¼å´ã§ã‚‚å¿…ãšæ¤œè¨¼ã—ã¾ã™ã€‚

```typescript
// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´æ¤œè¨¼ï¼ˆç¬¬ä¸€é˜²è¡›ç·šï¼‰
// - å³æ™‚ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
// - æ˜ç™½ãªã‚¨ãƒ©ãƒ¼ã‚’é˜²æ­¢
// - UXå‘ä¸Š

// ã‚µãƒ¼ãƒãƒ¼å´æ¤œè¨¼ï¼ˆå¿…é ˆï¼‰
// - çœŸã®ã‚½ãƒ¼ã‚¹
// - æ”¹ã–ã‚“é˜²æ­¢
// - å¤‰åŒ–ã™ã‚‹æ¥­å‹™ãƒ«ãƒ¼ãƒ«ã‚’å¼·åˆ¶
// - åŒæ™‚ç·¨é›†ã«å¯¾å¿œ

// ã‚µãƒ¼ãƒãƒ¼å¿œç­”å¾Œã«ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçŠ¶æ…‹ã‚’æ›´æ–°
const response = await fetch('/api/save', { method: 'POST', body: data });

if (response.ok) {
  // ã‚µãƒ¼ãƒãƒ¼æ¤œè¨¼OK
  table.commit();
} else {
  // ã‚µãƒ¼ãƒãƒ¼ãŒæ¤œè¨¼ã‚¨ãƒ©ãƒ¼ã‚’è¿”å´
  const errors = await response.json();
  displayServerErrors(errors);
}
```

## é–¢é€£é …ç›®

- [ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚¬ã‚¤ãƒ‰](/ja/guides/data-format) - åˆ—å‹ã¨åˆ¶ç´„
- [æ•°å¼ã‚¬ã‚¤ãƒ‰](/ja/guides/formulas) - é«˜åº¦ãªæ•°å¼ãƒ‘ã‚¿ãƒ¼ãƒ³
- [æ¡ä»¶ä»˜ãã‚¹ã‚¿ã‚¤ãƒ«ã‚¬ã‚¤ãƒ‰](/ja/guides/conditional-style) - è¦–è¦šçš„ãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
- [ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã‚¬ã‚¤ãƒ‰](/ja/guides/editmode) - direct/commitã®ä½¿ã„åˆ†ã‘
